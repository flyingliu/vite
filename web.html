<style>
  body,
  html {
    padding: 0;
    margin: 0;
  }
</style>

<img-list id="imgList" list="145_ËÄå.jpg,146_Áªà.jpg" selected="1"></img-list>

<script src="./data/zzwt.js"></script>
<script>
  (function () {
    'use strict';

    // Feature detect
    if (!(window.customElements && document.body.attachShadow)) {
      document.querySelector('fancy-tabs').innerHTML =
        "<b>Your browser doesn't support Shadow DOM and Custom Elements v1.</b>";
      return;
    }



    // See https://www.w3.org/TR/wai-aria-practices-1.1/#tabpanel

    customElements.define(
      'img-list',
      class extends HTMLElement {
        #shadowRoot;
        #viewImg;
        #selected;
        #boundOnTitleClick;
        #boundOnKeyDown;
        tabs = [];

        static get observedAttributes () {
          return ['selected', 'list']
        }

        constructor () {
          super(); // always call super() first in the ctor.

          // Create shadow DOM for the component.
          this.#shadowRoot = this.attachShadow({ mode: 'open' });

        }

        get list () {
          return this._list
        }
        set list (v) {
          this.setAttribute('list', v)
        }


        get selected () {
          return this.#selected;
        }

        set selected (idx) {
          this.#selected = idx;
          this.selectTab(idx);
        }

        connectedCallback () {

          this._updateRendering()
        }

        attributeChangedCallback (name, oldValue, newValue) {
          console.log('Ëá™ÂÆö‰πâÂÖÉÁ¥†Â±ûÊÄßÂèëÁîüÂèòÂåñ', name, oldValue, newValue)
          const keys = {
            selected: () => this.selected = newValue,
            list: () => {
              this._list = newValue
              this._updateRendering()
            }
          }
          keys[name]?.()
        }
        disconnectedCallback () {
          // this.#tabsSlot.removeEventListener('click', this.#boundOnTitleClick);
          // this.#tabsSlot.removeEventListener('keydown', this.#boundOnKeyDown);
        }

        #onTitleClick (e) {
          this.selected = this.tabs.indexOf(e.target);
        }

        #onKeyDown (e) {
          switch (e.code) {
            case 'ArrowUp':
            case 'ArrowLeft':
              e.preventDefault();
              var idx = this.selected - 1;
              idx = idx < 0 ? this.tabs.length - 1 : idx;
              this.tabs[idx].click();
              break;
            case 'ArrowDown':
            case 'ArrowRight':
              e.preventDefault();
              var idx = this.selected + 1;
              this.tabs[idx % this.tabs.length].click();
              break;
            default:
              break;
          }
        }

        _updateRendering () {
          // console.log('Ëá™ÂÆö‰πâÂÖÉÁ¥†Âä†ÂÖ•È°µÈù¢', this._list)
          const baseUrl = '//qiniu.easywe.net/shufa/yanzhenqing/zhengzuowei/'
          const $li = this._list
            .split(',')
            .map((li) => `<img class="item" src="${baseUrl + li}-small" alt="${baseUrl + li}" />`)
            .join('')


          this.#shadowRoot.innerHTML =  /*san*/`
            <div class="imgbox">
              <main><img id="viewImg" src="" /></main>
              <aside id="aside" class="">
                <dl>
                  <dd id="toggle">üçä</dd>
                  <dd>üçé</dd>
                  <dd>ü•ë</dd>
                  <dd>üçÑ</dd>
                </dl>
                <div class="title"><slot></slot></div>
                <div class="imgul">${$li}</div>
              </aside>
            </div>
            <style>
              .imgbox {
                display: flex; flex-flow: row nowrap;
                aside {
                  position: relative;
                  background: #ccc;
                  width: 20%; 
                  display: flex; 
                  height:100vh; 
                  overflow: auto;
                  padding: 0 0 0 24px;
                  &.side {
                    position: absolute;
                    right: -20%;
                  }
                  dl {
                    position: absolute;
                    left: 0px;
                    width: 20px;
                    display: flex;
                    justify-content: start;
                    align-items: center;
                    flex-flow: column nowrap;
                    dd { 
                      text-align: center;
                      width:20px; 
                      height:20px; 
                      border-radius: 50%; 
                      padding:0; 
                      margin:10px 0;
                      cursor: pointer;
                    }
                  }
                }
                main { 
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  height: 100vh;
                  flex: auto;
                }
              }
              .imgbox .title { font:bold 14px arial; padding: 10px 0;}
              .imgul { display: flex; flex-flow: row wrap;align-content: flex-start;}
              .imgul {}
              .imgul img { border:2px solid #ccc; display:block; width:36px;height:36px; object-fit:cover;}
              .imgul img[aria-selected="true"]{ border:2px solid #900; }
            </style>
          `;
          this.setAttribute('role', 'tablist');

          this.tabs = Array.from(this.#shadowRoot.querySelectorAll('.item'))
          this.#viewImg = this.#shadowRoot.querySelector('#viewImg')

          // Referernces to we can remove listeners later.
          this.#boundOnTitleClick = this.#onTitleClick.bind(this);
          this.#boundOnKeyDown = this.#onKeyDown.bind(this);

          for (let tab of this.tabs) {
            tab.addEventListener('click', this.#boundOnTitleClick);
            tab.addEventListener('keydown', this.#boundOnKeyDown);
          }

          const toggle = this.#shadowRoot.querySelector('#toggle')
          toggle.addEventListener('click', () => {
            this.#shadowRoot.querySelector('aside').classList.toggle('side')
          })

          this.selectTab(this.selected)
        }

        selectTab (idx = null) {
          console.log('index', idx)
          for (let [i, tab] of this.tabs.entries()) {
            const select = i === +idx;
            tab.setAttribute('tabindex', select ? 0 : -1);
            tab.setAttribute('aria-selected', select);
            this.#viewImg.src = this.tabs[idx]?.alt
          }
        }
      }
    );



    const imgList = document.getElementById('imgList')
    imgList.list = zhengzuowei.toString()
    // let index = 0
    // setInterval(() => {
    //   imgList.setAttribute('selected',index) 
    //   index++
    // }, 1000);


  })();
</script>