import{s as d,r as _,h as x,v as H,_ as b,j as I,o as L,c as M,p as A,e as D,b as E}from"./index.94cbc2d4.js";let c={};const C={align:"center",isMove:!0,x:0,y:0,iconId:"",url:"/images/love.png",data:[],callback:{},element:void 0};class S{constructor(t,e={}){this.krpano=t,this.option=e}register(t,e={}){return this.option={...this.option,...e},c[t]?c[t]:new V(t,this.option,this.krpano)}switch(t){this.krpano.hotspot.getArray().forEach(e=>{e.hotspot_type&&(e.visible=t)})}getHotspots(){return this.krpano.hotspot.getArray()}onremovepano(){for(var t in c)c[t].hotspotList=[]}finishData(t){return m(t)}finishDataList(t){for(var e in t)t[e]=m(t[e]);return t}}class V{constructor(t,e={},o){if(this.hotspotType=t,this.option=e,this.krpano=o,this.hotspotList=[],console.log("RegisterHotspot",this.krpano),!t)return console.error("\u5FC5\u987B\u8F93\u5165hotspotType");e.data&&this.init(e)}init(t){const e=t.data;t.data=void 0;for(var o in e)this.addHotspot($.extend(!0,{data:{}},t,e[o],{callback:{onAddHotspot:function(){}}}))}addHotspot(t={}){let e;return t.hotspotType=this.hotspotType,t=$.extend(!0,{},C,this.option,t),e=new T(this.krpano,t),this.hotspotList.push(e),e}getHotspot(t){var e=this.hotspotList,o;if(t){for(o in e)if(t==e[o].name)return e[o];return console.error("\u672A\u627E\u5230\u70ED\u70B9\uFF0Cname=",t)}return e}}class T{constructor(t,e={}){this.option=e,this.krpano=t,this.init()}init(){var t=this,e=this.option||{};console.log("opt",e);var o=this.krpano,n=e.ath||0,r=e.atv||0,i;if(!e.name)do this.name="flying_"+Math.random().toString(36).substring(2);while(o.get("hotspot["+this.name+"]"));if(!n&&n!==0&&!n&&n!==0){o.call("adjusthlookat(view.hlookat)"),n=o.view.hlookat,r=o.view.vlookat,o.spheretoscreen(o.view.hlookat,o.view.vlookat);var u=e.x||0,v=e.y||0;if(u||v){var f=o.screentosphere(u,v);n=f.x,r=f.y}}else n=n||0,r=r||0;typeof e.element=="function"?this.element=$(e.element(e.data)):this.element=$(e.element).clone(!0),this.data=e.data||{};var i=this.hotspot=o.addhotspot(this.name);if(i.keep=!0,i.align=e.align,i.ath=n,i.atv=r,i.hotspot_type=e.hotspotType,i.scale=.5,e.iconId?g(this,e.iconId):i.url=e.url,this.element){var w="layer_"+this.name,a=t.layer=o.addlayer(w);a.type="container",a.align="right",a.edge="left",$(a.sprite).append(this.element),$(a.sprite).delegate(":text, textarea","click mousedown mousedown focus",function(l){l.stopPropagation()}),$(a.sprite).delegate(".move","mousedown touchstart",function(l){i.ondown(),$(document).on("mouseup touchend",function(F){i.onup(),$(document).off("mouseup touchend")})}),$(a.sprite).delegate(".click","click",function(l){return l.preventDefault(),i.onclick(),!1}),$(a.sprite).delegate(".click",{touchstart:function(l){i.isClick=!0},touchmove:function(l){i.isClick=!1},touchend:function(){i.isClick&&i.onclick()}}),a.bgcapture=!0,a.parent="hotspot["+this.name+"]"}this.option.isMove||(i.capture=!1),h("onLoaded",t),h("onAddHotspot",t),i.onclick=p("onClick",this),i.onover=p("onOver",this),i.onout=p("onOut",this),i.onhover=p("onHover",this),i.ondown="draghotspot();",i.onup=function(){i.zorder--,h("onUp",this),this.option.isMove&&(i.dragx!=o.mouse.stagex||i.dragy!=o.mouse.stagey)&&h("onMoveUpdate",this),i.pressed=!1,i.dragx=i.dragy=0}.bind(this)}setMove(t){this.option.isMove=!!t||!this.option.isMove}setKeep(t){this.hotspot.keep=!!t,this.layer.keep=!!t}update(t){t=t||{},t.style!==void 0&&g(this,t.style),t.url&&(this.hotspot.onloaded=void 0,this.hotspot.crop=void 0,this.hotspot.style="",this.hotspot.url=t.url),t.data&&(this.data=$.extend(!0,{},this.data,t.data)),h("onUpdatestyle",this)}remove(){console.log("remove this"),this.option.krpano.removelayer(this.layer.name),this.option.krpano.removehotspot(this.name),h("onRemove",this);for(var t in c){var e=c[t].hotspotList;for(var o in e)if(e[o]===this){e.splice(o,1);break}}}zorder(t){this.hotspot.zorder=t?101+100:101}save(t){h("onSaveHotspot",this)}getData(){var t=$.extend(!0,{},{data:this.data});return t.ath=this.hotspot.ath,t.atv=this.hotspot.atv,t.iconId=parseInt(this.hotspot.iconid),t.url=this.hotspot.url,t}getOldData(){var t=$.extend(!0,{},this.data);return t.ath=this.hotspot.ath,t.atv=this.hotspot.atv,t.iconId=parseInt(this.hotspot.iconid),t.url=this.hotspot.url,t}}function g(s,t){typeof t=="object"&&(t=t.name),typeof t=="string"&&funs.yp.method.icon.getIcon(t)?s.hotspot.loadstyle(t):typeof t=="number"?(t=funs.yp.method.icon.getStyle(t),s.hotspot.loadstyle(t.name)):this.yp("\u672A\u627E\u5230style=",t)}function p(s,t){var e=t.option.callback[s];if(e&&typeof e=="function")return e.bind(t,t.getData())}function h(s,t){var e=t.option.callback[s];e&&typeof e=="function"&&e.call(t,t.getData())}function m(s){return{data:s,atv:s.atv,ath:s.ath,iconId:s.iconId}}var k={props:["modelValue"],emits:["update:modelValue"],render(){return d("input",{onClick:s=>{console.log(s)},modelValue:this.modelValue,"onUpdate:modelValue":s=>this.$emit("update:modelValue",s)})}},U={setup(){_(0);const s=x({title:"Vue 3 Guide"});return()=>d("div",{class:"abc",onClick:function(){console.log("book.title",s.title,this)}},[d(k),d(k)])}},O="/images/love.png",B='<div class="hotspotwrap"></div>',y={};const P={align:"center",isMove:!0,url:O,iconId:!1,element:B,callback:{onClick:function(){console.log("this onClick",this)},onUp:function(t){console.log("this onUp",this)},onLoaded:function(){console.log("this onLoaded",this);var s=this.element[0];H(U).mount(s)},onAddHotspot:function(){y=this,console.log("this currentHotspot",y)}}};class R{constructor(t,e={}){this.option={...P,...e},this.krpano=t,this.init()}init(t){this.option.data=this.krpano.method.hotspot.finishDataList(t),this.here=this.krpano.method.hotspot.register("here",this.option),console.log("this.here",this.here)}addHere(t={}){this.here.addHotspot(t)}onnewscene(){console.log("this is on new scene")}}const j=s=>(A("data-v-f612385a"),s=s(),D(),s),z=j(()=>E("div",{id:"pano"},null,-1)),G=[z],N={__name:"index",setup(s){const t=()=>new Promise((e,o)=>{embedpano({xml:"/test/animated-hotspots/anihotspots.xml",target:"pano",html5:"only",onready:function(n){n=n.get("global"),window.krpano=n,e(n)}})});return I(()=>{setTimeout(()=>{t().then(e=>{e.method={hotspot:new S(e)},e.my={here:new R(e)},e.view.hlookat=123.4,e.view.vlookat=12.3,e.view.fov=120,e.actions.loadpano("/test/animated-hotspots/anihotspots.xml",null,"MERGE","BLEND(0.5)");var o=e.addlayer();o.name="flyingishere",o.type="container",o.align="right",o.edge="left",o.width=100,o.height=100;var n=e.addhotspot();n.name="haha",n.url="/images/cat.png",n.keep=!0,n.ath=0,n.atv=0,n.width=50,n.height=50,n.ondown="draghotspot();",n.layer=o,n.onclick=function(){e.actions.loadscene("scene2")},n.onout=function(){console.log(n)};const r=e.events.createItem("skin_plugin_vr");r.keep=!0,r.onnewscene=()=>{console.log("newnew!!")}})},0)}),(e,o)=>(L(),M("div",null,G))}};var q=b(N,[["__scopeId","data-v-f612385a"]]);export{q as default};
