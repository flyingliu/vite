import{f as w,g as y}from"./util.70a3f6d9.js";import{g as k,i as N,a as n,o as f,j as m,w as i,b as V,e as d,c as x,F as z,h as q,d as _,k as B}from"./index.39170f17.js";const E={class:"cc"},D={__name:"s-fonts",props:["state"],setup(F){const r=F,o=k({isComputerFontsLoads:!1,familylist:w.map(e=>typeof e=="string"?{label:y(e),value:e,isLoad:!1}:e)});async function L(){const{state:e}=await navigator.permissions.query({name:"local-fonts"});console.log(e),e==="granted"&&p()}function b(e){var t=/[\u4E00-\u9FA5\uF900-\uFA2D]{1,}/;return t.test(e)}async function p(){const e=await queryLocalFonts();console.log("%c [ fonts ]-62","font-size:13px; background:pink; color:#bf2c9f;",e),e.length?(o.isComputerFontsLoads=!0,e.filter(l=>b(l.fullName)).forEach(l=>{o.familylist.map(s=>s.label).includes(l.fullName)||o.familylist.push({label:l.fullName,value:l.family,isLoad:!0})})):alert("\u8BF7\u914D\u7F6E\u672C\u673A\u5B57\u4F53\u8BBF\u95EE\u6743\u9650")}const g=e=>{const t=o.familylist.find(l=>l.value===e);t&&u(t)},v=e=>{const t=window.URL.createObjectURL(e.raw),l=y(e.name),a=o.familylist;a.find(s=>s.label!=l)&&a.push({value:t,label:l,isLoad:!1}),u(a.find(s=>s.label==l))};function u(e={}){if(e.isLoad)r.state.fontFamily=e.label;else{const t=document.fonts,l=new FontFace(e.label,"url("+e.value+")");l.load().then(a=>(t.add(l),r.state.fontFamily=e.label,e.isLoad=!0,e)).catch(a=>{alert("\u5B57\u4F53\u52A0\u8F7D\u9519\u8BEF\uFF01"),console.error(a)})}}return N(()=>{L(),u(o.familylist[0])}),(e,t)=>{const l=n("el-option"),a=n("el-select"),s=n("el-button"),h=n("el-upload"),C=n("el-form-item");return f(),m(C,{label:"\u5B57\u4F53\u8BBE\u7F6E"},{default:i(()=>[V("div",E,[d(a,{placeholder:"please select your zone",onChange:g,modelValue:r.state.fontFamily,"onUpdate:modelValue":t[0]||(t[0]=c=>r.state.fontFamily=c),size:"small"},{default:i(()=>[(f(!0),x(z,null,q(o.familylist,c=>(f(),m(l,{value:c.value,label:c.label},null,8,["value","label"]))),256))]),_:1},8,["modelValue"]),d(h,{class:"upload-demo",action:"#","on-change":v,"http-request":()=>{},"file-list":[],"show-file-list":!1},{default:i(()=>[d(s,{size:"small",type:"primary",plain:""},{default:i(()=>t[1]||(t[1]=[_("\u672C\u5730\u5B57\u4F53")])),_:1})]),_:1}),o.isComputerFontsLoads?B("",!0):(f(),m(s,{key:0,size:"small",type:"primary",plain:"",onClick:p},{default:i(()=>t[2]||(t[2]=[_("\u672C\u673A\u5B57\u4F53")])),_:1}))])]),_:1})}}};export{D as _};
