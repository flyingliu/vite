import{_ as w,r as L,o as v,c as f,b,t as m,F as M,h as C,k as E,i as I,p as D,q as A}from"./index.4825996d.js";let u={};const O={align:"center",isMove:!0,x:0,y:0,iconId:"",url:"/images/love.png",data:[],callback:{},element:void 0};class B{constructor(t,e={}){this.krpano=t,this.option=e}register(t,e={}){return this.option={...this.option,...e},u[t]?u[t]:new F(t,this.option,this.krpano)}switch(t){this.krpano.hotspot.getArray().forEach(e=>{e.hotspot_type&&(e.visible=t)})}getHotspots(){return this.krpano.hotspot.getArray()}onremovepano(){for(var t in u)u[t].hotspotList=[]}finishData(t){return y(t)}finishDataList(t){for(var e in t)t[e]=y(t[e]);return t}}class F{constructor(t,e={},o){if(this.hotspotType=t,this.option=e,this.krpano=o,this.hotspotList=[],console.log("RegisterHotspot",this.krpano),!t)return console.error("\u5FC5\u987B\u8F93\u5165hotspotType");e.data&&this.init(e)}init(t){const e=t.data;t.data=void 0;for(var o in e)this.addHotspot($.extend(!0,{data:{}},t,e[o],{callback:{onAddHotspot:function(){}}}))}addHotspot(t={}){let e;return t.hotspotType=this.hotspotType,t=$.extend(!0,{},O,this.option,t),e=new N(this.krpano,t),this.hotspotList.push(e),e}getHotspot(t){var e=this.hotspotList,o;if(t){for(o in e)if(t==e[o].name)return e[o];return console.error("\u672A\u627E\u5230\u70ED\u70B9\uFF0Cname=",t)}return e}}class N{constructor(t,e={}){this.option=e,this.krpano=t,this.init()}init(){var t=this,e=this.option||{};console.log("opt",e);var o=this.krpano,s=e.ath||0,a=e.atv||0,n;if(!e.name)do this.name="flying_"+Math.random().toString(36).substring(2);while(o.get("hotspot["+this.name+"]"));if(!s&&s!==0&&!s&&s!==0){o.call("adjusthlookat(view.hlookat)"),s=o.view.hlookat,a=o.view.vlookat,o.spheretoscreen(o.view.hlookat,o.view.vlookat);var d=e.x||0,p=e.y||0;if(d||p){var c=o.screentosphere(d,p);s=c.x,a=c.y}}else s=s||0,a=a||0;typeof e.element=="function"?this.element=$(e.element(e.data)):this.element=$(e.element).clone(!0),this.data=e.data||{};var n=this.hotspot=o.addhotspot(this.name);if(n.keep=!0,n.align=e.align,n.ath=s,n.atv=a,n.hotspot_type=e.hotspotType,n.capture=!0,n.scale=.5,e.iconId?k(this,e.iconId):n.url=e.url,this.element){var H="layer_"+this.name,r=t.layer=o.addlayer(H);r.type="container",r.keep=!0,r.align="right",r.edge="left",$(r.sprite).append(this.element),$(r.sprite).delegate(":text, textarea","click mousedown mousedown focus",function(h){h.stopPropagation()}),$(r.sprite).delegate(".move","mousedown touchstart",function(h){n.ondown(),$(document).on("mouseup touchend",function(q){n.onup(),$(document).off("mouseup touchend")})}),$(r.sprite).delegate(".click","click",function(h){return h.preventDefault(),n.onclick(),!1}),$(r.sprite).delegate(".click",{touchstart:function(h){n.isClick=!0},touchmove:function(h){n.isClick=!1},touchend:function(){n.isClick&&n.onclick()}}),r.bgcapture=!0,r.parent="hotspot["+this.name+"]"}this.option.isMove||(n.capture=!1),l("onLoaded",t),l("onAddHotspot",t),n.onclick=g("onClick",this),n.onover=g("onOver",this),n.onout=g("onOut",this),n.onhover=g("onHover",this),n.ondown="draghotspot();",n.onup=function(){n.zorder--,l("onUp",this),this.option.isMove&&(n.dragx!=o.mouse.stagex||n.dragy!=o.mouse.stagey)&&l("onMoveUpdate",this),n.pressed=!1,n.dragx=n.dragy=0}.bind(this)}setMove(t){this.option.isMove=!!t||!this.option.isMove}setKeep(t){this.hotspot.keep=!!t,this.layer.keep=!!t}update(t){t=t||{},t.style!==void 0&&k(this,t.style),t.url&&(this.hotspot.onloaded=void 0,this.hotspot.crop=void 0,this.hotspot.style="",this.hotspot.url=t.url),t.data&&(this.data=$.extend(!0,{},this.data,t.data)),l("onUpdatestyle",this)}remove(){console.log("remove this"),this.option.krpano.removelayer(this.layer.name),this.option.krpano.removehotspot(this.name),l("onRemove",this);for(var t in u){var e=u[t].hotspotList;for(var o in e)if(e[o]===this){e.splice(o,1);break}}}zorder(t){this.hotspot.zorder=t?101+100:101}save(t){l("onSaveHotspot",this)}getData(){var t=$.extend(!0,{},{data:this.data});return t.ath=this.hotspot.ath,t.atv=this.hotspot.atv,t.iconId=parseInt(this.hotspot.iconid),t.url=this.hotspot.url,t}getOldData(){var t=$.extend(!0,{},this.data);return t.ath=this.hotspot.ath,t.atv=this.hotspot.atv,t.iconId=parseInt(this.hotspot.iconid),t.url=this.hotspot.url,t}}function k(i,t){typeof t=="object"&&(t=t.name),typeof t=="string"?i.hotspot.loadstyle(t):typeof t=="number"?i.hotspot.loadstyle(t.name):this.yp("\u672A\u627E\u5230style=",t)}function g(i,t){var e=t.option.callback[i];if(e&&typeof e=="function")return e.bind(t,t.getData())}function l(i,t){var e=t.option.callback[i];e&&typeof e=="function"&&e.call(t,t.getData())}function y(i){return{data:i,atv:i.atv,ath:i.ath,iconId:i.iconId}}var R="/images/love.png",T='<div class="herewrap">bababa</div>',_={};const U={align:"center",isMove:!0,url:R,iconId:!1,element:T,callback:{onClick:function(){console.log("this onClick",this)},onUp:function(t){console.log("this onUp",this)},onLoaded:function(){console.log("this onLoaded",this)},onAddHotspot:function(){_=this,console.log("this currentHotspot",_)}}};class P{constructor(t,e={}){this.option={...U,...e},this.krpano=t,this.init()}init(t){const e=new B(this.krpano,this.option);this.option.data=e.finishDataList(t),this.here=e.register("here",this.option)}addHere(t={}){this.here.addHotspot(t)}onnewscene(){console.log("this is on new scene")}}const S={class:"logomenu"},j={key:0},G={__name:"LogoMenu",props:{title:{type:String,default:"\u521B\u610F\u753B\u623F"},menu:{type:Array,default:()=>[]}},setup(i){const t=L(!1);return(e,o)=>(v(),f("main",S,[b("h1",{onClick:o[0]||(o[0]=s=>t.value=!t.value),onclick:"alert('2332')"},m(i.title),1),t.value?(v(),f("dl",j,[(v(!0),f(M,null,C(i.menu,s=>(v(),f("dd",{key:s.name},m(s.name),1))),128))])):E("",!0)]))}};var z=w(G,[["__scopeId","data-v-bcef244a"]]);function x(i,t={}){const e=i.addlayer();return t={...{name:"layer",url:"/pano/logo1.png",align:"lefttop",keep:!0,scale:1,x:20,y:20,capture:!1,bgcapture:!1,onclick:"openurl('/', _blank);"},...t},Object.keys(t).forEach(s=>{e[s]=t[s]}),e}const V={__name:"index",setup(i){console.log("Heres",x);const t=()=>new Promise((e,o)=>{embedpano({xml:"/krpano/krpano.xml",target:"pano",html5:"only",passQueryParameters:!0,onerror:function(s){console.log("embedpano error",s),o(s)},onready:function(s){s=s.get("global"),window.krpano=s,e(s)}})});return I(async()=>{const e=await t();console.log("krpano",e);const o=new P(e,{});o.addHere({ath:20,atv:20,url:"/images/cat.png",isMove:!0,element:'<div onClick="alert(12232)">haha</div>',callback:{onClick:()=>{console.log("onClick");function p(){if(e){var c=`<krpano>
              <preview type="grid(cube,64,64,512,0xCCCCCC,0xF6F6F6,0x999999);" />
              <image><sphere url="/pano/2.jpeg" /></image>
              <view hlookat="0" vlookat="0" fov="100" distortion="0.0" />
              </krpano>`;e.call("loadxml("+escape(c)+", null, MERGE, BLEND(0.5));")}}p()}}}),console.log(o),e.actions.loadpano("/test/animated-hotspots/anihotspots.xml",null,"MERGE","BLEND(0.5)");let s=x(e,{name:"logo",url:"/pano/t.png",scale:1,onclick:""});D({render:()=>A(z,{menu:[{name:"\u6D77\u5929\u4E00\u8272",url:"/111"},{name:"\u6D77\u5E95\u63FD\u80DC",url:"/222"},{name:"\u95F2\u5EAD\u4FE1\u6B65",url:"/333"}]})}).mount(s.sprite);var a=e.addhotspot();a.name="haha11",a.url="/images/cat.png",a.keep=!0,a.ath=0,a.atv=0,a.width=50,a.height=50,a.ondown="draghotspot();",a.onclick=function(){function p(){if(e){let c=`<krpano>
          <scene name="scene3" onstart="" autoload="false" >
            <preview type="grid(sphere,16,16,512,0x666666,0x333333,0x999999);" />
            <image><sphere url="/pano/3.jpeg" /></image>
            <view hlookat="0" vlookat="0" fov="100" distortion="0.0" />
          </scene>
        </krpano>`;e.call("loadxml("+escape(c)+", null, MERGE, BLEND(0.5));")}}p(),e.actions.loadscene("scene3")},a.onout=function(){};const d=e.events.createItem("skin_plugin_vr");d.keep=!0,d.onnewscene=()=>{console.log("newnew!!")}}),(e,o)=>(v(),f("div",null,o[0]||(o[0]=[b("div",{id:"pano"},null,-1)])))}};var Q=w(V,[["__scopeId","data-v-cc2fa8d6"]]);export{Q as default};
