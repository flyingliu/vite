import{_ as w,i as x,o as H,c as b,b as _}from"./index.39170f17.js";let p={};const I={align:"center",isMove:!0,x:0,y:0,iconId:"",url:"/images/love.png",data:[],callback:{},element:void 0};class M{constructor(t,o={}){this.krpano=t,this.option=o}register(t,o={}){return this.option={...this.option,...o},p[t]?p[t]:new L(t,this.option,this.krpano)}switch(t){this.krpano.hotspot.getArray().forEach(o=>{o.hotspot_type&&(o.visible=t)})}getHotspots(){return this.krpano.hotspot.getArray()}onremovepano(){for(var t in p)p[t].hotspotList=[]}finishData(t){return g(t)}finishDataList(t){for(var o in t)t[o]=g(t[o]);return t}}class L{constructor(t,o={},e){if(this.hotspotType=t,this.option=o,this.krpano=e,this.hotspotList=[],console.log("RegisterHotspot",this.krpano),!t)return console.error("\u5FC5\u987B\u8F93\u5165hotspotType");o.data&&this.init(o)}init(t){const o=t.data;t.data=void 0;for(var e in o)this.addHotspot($.extend(!0,{data:{}},t,o[e],{callback:{onAddHotspot:function(){}}}))}addHotspot(t={}){let o;return t.hotspotType=this.hotspotType,t=$.extend(!0,{},I,this.option,t),o=new D(this.krpano,t),this.hotspotList.push(o),o}getHotspot(t){var o=this.hotspotList,e;if(t){for(e in o)if(t==o[e].name)return o[e];return console.error("\u672A\u627E\u5230\u70ED\u70B9\uFF0Cname=",t)}return o}}class D{constructor(t,o={}){this.option=o,this.krpano=t,this.init()}init(){var t=this,o=this.option||{};console.log("opt",o);var e=this.krpano,s=o.ath||0,i=o.atv||0,n;if(!o.name)do this.name="flying_"+Math.random().toString(36).substring(2);while(e.get("hotspot["+this.name+"]"));if(!s&&s!==0&&!s&&s!==0){e.call("adjusthlookat(view.hlookat)"),s=e.view.hlookat,i=e.view.vlookat,e.spheretoscreen(e.view.hlookat,e.view.vlookat);var c=o.x||0,u=o.y||0;if(c||u){var v=e.screentosphere(c,u);s=v.x,i=v.y}}else s=s||0,i=i||0;typeof o.element=="function"?this.element=$(o.element(o.data)):this.element=$(o.element).clone(!0),this.data=o.data||{};var n=this.hotspot=e.addhotspot(this.name);if(n.keep=!0,n.align=o.align,n.ath=s,n.atv=i,n.hotspot_type=o.hotspotType,n.capture=!0,n.scale=.5,o.iconId?f(this,o.iconId):n.url=o.url,this.element){var y="layer_"+this.name,r=t.layer=e.addlayer(y);r.type="container",r.keep=!0,r.align="right",r.edge="left",$(r.sprite).append(this.element),$(r.sprite).delegate(":text, textarea","click mousedown mousedown focus",function(l){l.stopPropagation()}),$(r.sprite).delegate(".move","mousedown touchstart",function(l){n.ondown(),$(document).on("mouseup touchend",function(T){n.onup(),$(document).off("mouseup touchend")})}),$(r.sprite).delegate(".click","click",function(l){return l.preventDefault(),n.onclick(),!1}),$(r.sprite).delegate(".click",{touchstart:function(l){n.isClick=!0},touchmove:function(l){n.isClick=!1},touchend:function(){n.isClick&&n.onclick()}}),r.bgcapture=!0,r.parent="hotspot["+this.name+"]"}this.option.isMove||(n.capture=!1),h("onLoaded",t),h("onAddHotspot",t),n.onclick=d("onClick",this),n.onover=d("onOver",this),n.onout=d("onOut",this),n.onhover=d("onHover",this),n.ondown="draghotspot();",n.onup=function(){n.zorder--,h("onUp",this),this.option.isMove&&(n.dragx!=e.mouse.stagex||n.dragy!=e.mouse.stagey)&&h("onMoveUpdate",this),n.pressed=!1,n.dragx=n.dragy=0}.bind(this)}setMove(t){this.option.isMove=!!t||!this.option.isMove}setKeep(t){this.hotspot.keep=!!t,this.layer.keep=!!t}update(t){t=t||{},t.style!==void 0&&f(this,t.style),t.url&&(this.hotspot.onloaded=void 0,this.hotspot.crop=void 0,this.hotspot.style="",this.hotspot.url=t.url),t.data&&(this.data=$.extend(!0,{},this.data,t.data)),h("onUpdatestyle",this)}remove(){console.log("remove this"),this.option.krpano.removelayer(this.layer.name),this.option.krpano.removehotspot(this.name),h("onRemove",this);for(var t in p){var o=p[t].hotspotList;for(var e in o)if(o[e]===this){o.splice(e,1);break}}}zorder(t){this.hotspot.zorder=t?101+100:101}save(t){h("onSaveHotspot",this)}getData(){var t=$.extend(!0,{},{data:this.data});return t.ath=this.hotspot.ath,t.atv=this.hotspot.atv,t.iconId=parseInt(this.hotspot.iconid),t.url=this.hotspot.url,t}getOldData(){var t=$.extend(!0,{},this.data);return t.ath=this.hotspot.ath,t.atv=this.hotspot.atv,t.iconId=parseInt(this.hotspot.iconid),t.url=this.hotspot.url,t}}function f(a,t){typeof t=="object"&&(t=t.name),typeof t=="string"?a.hotspot.loadstyle(t):typeof t=="number"?a.hotspot.loadstyle(t.name):this.yp("\u672A\u627E\u5230style=",t)}function d(a,t){var o=t.option.callback[a];if(o&&typeof o=="function")return o.bind(t,t.getData())}function h(a,t){var o=t.option.callback[a];o&&typeof o=="function"&&o.call(t,t.getData())}function g(a){return{data:a,atv:a.atv,ath:a.ath,iconId:a.iconId}}var E="/images/love.png",A='<div class="herewrap">bababa</div>',k={};const C={align:"center",isMove:!0,url:E,iconId:!1,element:A,callback:{onClick:function(){console.log("this onClick",this)},onUp:function(t){console.log("this onUp",this)},onLoaded:function(){console.log("this onLoaded",this)},onAddHotspot:function(){k=this,console.log("this currentHotspot",k)}}};class m{constructor(t,o={}){this.option={...C,...o},this.krpano=t,this.init()}init(t){const o=new M(this.krpano,this.option);this.option.data=o.finishDataList(t),this.here=o.register("here",this.option)}addHere(t={}){this.here.addHotspot(t)}onnewscene(){console.log("this is on new scene")}}const O={__name:"index",setup(a){console.log("Heres",m);const t=()=>new Promise((o,e)=>{embedpano({xml:"/krpano/krpano.xml",target:"pano",html5:"only",onready:function(s){s=s.get("global"),window.krpano=s,o(s)}})});return x(async()=>{const o=await t();console.log("krpano",o);const e=new m(o,{});e.addHere({ath:20,atv:20,url:"/images/cat.png",isMove:!1,element:"<div>haha</div>"}),console.log(e),o.actions.loadpano("/test/animated-hotspots/anihotspots.xml",null,"MERGE","BLEND(0.5)");var s=o.addlayer();s.name="logo",s.url="/images/cat.png",s.align="lefttop",s.keep=!0,s.scale=.2,s.x=10,s.y=300,s.onclick="openurl('http://www.360cities.net', _blank);";var i=o.addhotspot();i.name="haha",i.url="/images/cat.png",i.keep=!0,i.ath=0,i.atv=0,i.width=50,i.height=50,i.ondown="draghotspot();",i.layer=s,i.onclick=function(){o.actions.loadscene("scene2")},i.onout=function(){console.log(i)};const c=o.events.createItem("skin_plugin_vr");c.keep=!0,c.onnewscene=()=>{console.log("newnew!!")}}),(o,e)=>(H(),b("div",null,e[0]||(e[0]=[_("div",{id:"pano"},null,-1)])))}};var B=w(O,[["__scopeId","data-v-664929ec"]]);export{B as default};
