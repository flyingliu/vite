import{f as a,g as l}from"./util.70a3f6d9.js";import{l as e,s,r as t,o,c as n,w as i,i as u,j as r,h as c,q as f,u as m,F as d,v as p,k as y}from"./vendor.bd950cba.js";const b={class:"cc"},F=y("本地字体"),h=y("本机字体"),v={props:["state"],setup(y){const v=y;console.log("%c [ props ]-37","font-size:13px; background:pink; color:#bf2c9f;",v.state);const L=e({isComputerFontsLoads:!1,familylist:a.map((a=>"string"==typeof a?{label:l(a),value:a,isLoad:!1}:a))});async function g(){const a=await queryLocalFonts();if(a.length){L.isComputerFontsLoads=!0;a.filter((a=>{return l=a.fullName,/[\u4E00-\u9FA5\uF900-\uFA2D]{1,}/.test(l);var l})).forEach((a=>{L.familylist.map((a=>a.label)).includes(a.fullName)||L.familylist.push({label:a.fullName,value:a.family,isLoad:!0})}))}else alert("请配置本机字体访问权限")}const w=a=>{const l=L.familylist.find((l=>l.value===a));l&&k(l)},_=a=>{const e=window.URL.createObjectURL(a.raw),s=l(a.name),t=L.familylist;t.find((a=>a.label!=s))&&t.push({value:e,label:s,isLoad:!1}),k(t.find((a=>a.label==s)))};function k(a={}){if(a.isLoad)v.state.fontFamily=a.label;else{const l=document.fonts,e=new FontFace(a.label,"url("+a.value+")");e.load().then((s=>(l.add(e),v.state.fontFamily=a.label,a.isLoad=!0,a))).catch((a=>{alert("字体加载错误！"),console.error(a)}))}}return s((()=>{!async function(){const{state:a}=await navigator.permissions.query({name:"local-fonts"});console.log(a),"granted"===a&&g()}(),k(L.familylist[0])})),(a,l)=>{const e=t("el-option"),s=t("el-select"),y=t("el-button"),k=t("el-upload"),q=t("el-form-item");return o(),n(q,{label:"字体设置"},{default:i((()=>[u("div",b,[r(s,{placeholder:"please select your zone",onChange:w,modelValue:v.state.fontFamily,"onUpdate:modelValue":l[0]||(l[0]=a=>v.state.fontFamily=a),size:"small"},{default:i((()=>[(o(!0),c(d,null,f(m(L).familylist,(a=>(o(),n(e,{value:a.value,label:a.label},null,8,["value","label"])))),256))])),_:1},8,["modelValue"]),r(k,{class:"upload-demo",action:"#","on-change":_,"http-request":()=>{},"file-list":[],"show-file-list":!1},{default:i((()=>[r(y,{size:"small",type:"primary",plain:""},{default:i((()=>[F])),_:1})])),_:1},8,["http-request"]),m(L).isComputerFontsLoads?p("",!0):(o(),n(y,{key:0,size:"small",type:"primary",plain:"",onClick:g},{default:i((()=>[h])),_:1}))])])),_:1})}}};export{v as _};
